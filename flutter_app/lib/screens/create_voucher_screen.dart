\'dart:convert\';\nimport \'package:flutter/material.dart\';\nimport \'package:http/http.dart\' as http;\n\nclass CreateVoucherScreen extends StatefulWidget {\n  final String ipAddress;\n  final String token;\n\n  const CreateVoucherScreen({super.key, required this.ipAddress, required this.token});\n\n  @override\n  State<CreateVoucherScreen> createState() => _CreateVoucherScreenState();\n}\n\nclass _CreateVoucherScreenState extends State<CreateVoucherScreen> {\n  final _formKey = GlobalKey<FormState>();\n  int _amount = 1;\n  int _quota = 1; // in hours\n  int _expiration = 24; // in hours\n  bool _isLoading = false;\n  String _status = \'\';\n\n  Future<void> _createVouchers() async {\n    if (_formKey.currentState!.validate()) {\n      _formKey.currentState!.save();\n      setState(() {\n        _isLoading = true;\n        _status = \'Creating vouchers...\';\n      });\n\n      final Uri url = Uri.parse(\'https://\${widget.ipAddress}/api/v2/hotspot/vouchers?token=\${widget.token}\');\n\n      try {\n        final response = await http.post(\n          url,\n          headers: {\'Content-Type\': \'application/json; charset=UTF-8\'},\n          body: jsonEncode(<String, dynamic>{\n            \'amount\': _amount,\n            \'quota\': _quota * 60, // Convert hours to minutes\n            \'expire_time\': _expiration,\n            \'reusable\': 1, // 1 for single use\n            \'download_limit\': 0, // 0 for unlimited\n            \'upload_limit\': 0, // 0 for unlimited\n            \'rate_limit_unit\': \'mbps\',\n            \'note\': \'Generated by Flutter App\'\n          }),\n        );\n\n        final responseBody = jsonDecode(response.body);\n\n        if (response.statusCode == 200 && responseBody[\'errorCode\'] == 0) {\n          setState(() {\n            _status = \'Vouchers created successfully!\';\n            _isLoading = false;\n          });\n          Navigator.pop(context, true); // Return true to indicate success\n        } else {\n          setState(() {\n            _status = \'Failed to create vouchers: \${responseBody[\'msg\'] ?? \'Unknown error\'}\';\n            _isLoading = false;\n          });\n        }\n      } catch (e) {\n        setState(() {\n          _status = \'Error: \${e.toString()}\';\n          _isLoading = false;\n        });\n      }\n    }\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text(\'Create Vouchers\'),\n      ),\n      body: Padding(\n        padding: const EdgeInsets.all(16.0),\n        child: Form(\n          key: _formKey,\n          child: Column(\n            children: [\n              TextFormField(\n                decoration: const InputDecoration(labelText: \'Number of Vouchers\'),\n                keyboardType: TextInputType.number,\n                initialValue: _amount.toString(),\n                validator: (value) {\n                  if (value == null || int.tryParse(value) == null) {\n                    return \'Please enter a valid number\';\n                  }\n                  return null;\n                },\n                onSaved: (value) => _amount = int.parse(value!),\n              ),\n              TextFormField(\n                decoration: const InputDecoration(labelText: \'Quota (in hours)\'),\n                keyboardType: TextInputType.number,\n                initialValue: _quota.toString(),\n                validator: (value) {\n                  if (value == null || int.tryParse(value) == null) {\n                    return \'Please enter a valid number\';\n                  }\n                  return null;\n                },\n                onSaved: (value) => _quota = int.parse(value!),\n              ),\n              TextFormField(\n                decoration: const InputDecoration(labelText: \'Expiration (in hours)\'),\n                keyboardType: TextInputType.number,\n                initialValue: _expiration.toString(),\n                validator: (value) {\n                  if (value == null || int.tryParse(value) == null) {\n                    return \'Please enter a valid number\';\n                  }\n                  return null;\n                },\n                onSaved: (value) => _expiration = int.parse(value!),\n              ),\n              const SizedBox(height: 20),\n              ElevatedButton(\n                onPressed: _isLoading ? null : _createVouchers,\n                child: const Text(\'Create\'),\n              ),\n              const SizedBox(height: 20),\n              if (_isLoading)\n                const CircularProgressIndicator(),\n              if (_status.isNotEmpty)\n                Text(_status, style: const TextStyle(color: Colors.red)),\n            ],\n          ),\n        ),\n      ),\n    );\n  }\n}\n
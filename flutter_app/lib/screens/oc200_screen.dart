\'dart:convert\';\nimport \'package:flutter/material.dart\';\nimport \'package:http/http.dart\' as http;\nimport \'package:mangalam_wifi_zone/screens/vouchers_screen.dart\';\n\nclass OC200Screen extends StatefulWidget {\n  const OC200Screen({super.key});\n\n  @override\n  State<OC200Screen> createState() => _OC200ScreenState();\n}\n\nclass _OC200ScreenState extends State<OC200Screen> {\n  final _formKey = GlobalKey<FormState>();\n  String _ipAddress = \'192.168.0.233\'; // Default for convenience\n  String _username = \'\';\n  String _password = \'\';\n  bool _isLoading = false;\n  String _status = \'\';\n  String? _token;\n\n  Future<void> _login() async {\n    if (_formKey.currentState!.validate()) {\n      _formKey.currentState!.save();\n      setState(() {\n        _isLoading = true;\n        _status = \'Logging in...\';\n      });\n\n      final Uri url = Uri.parse(\'https://\$_ipAddress/api/v2/login\');\n\n      try {\n        // This is a simplified and potentially insecure way to handle SSL verification.\n        // In a production app, you would use a proper HttpClient that trusts the self-signed certificate.\n        final response = await http.post(\n          url,\n          headers: {\'Content-Type\': \'application/json; charset=UTF-8\'},\n          body: jsonEncode(<String, String>{\n            \'username\': _username,\n            \'password\': _password,\n          }),\n        );\n\n        final responseBody = jsonDecode(response.body);\n\n        if (response.statusCode == 200 && responseBody[\'errorCode\'] == 0) {\n          setState(() {\n            _status = \'Login successful!\';\n            _token = responseBody[\'result\'][\'token\'];\n            _isLoading = false;\n          });\n          // Navigate to the next screen on successful login\n          Navigator.push(\n            context,\n            MaterialPageRoute(\n              builder: (context) => VouchersScreen(ipAddress: _ipAddress, token: _token!),\n            ),\n          );\n        } else {\n          setState(() {\n            _status = \'Login failed: \${responseBody[\'msg\'] ?? \'Unknown error\'}\';\n            _isLoading = false;\n          });\n        }\n      } catch (e) {\n        setState(() {\n          _status = \'Error: \${e.toString()}\';\n          _isLoading = false;\n        });\n      }\n    }\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text(\'OC200 Login\'),\n      ),\n      body: SingleChildScrollView(\n        padding: const EdgeInsets.all(16.0),\n        child: Form(\n          key: _formKey,\n          child: Column(\n            children: [\n              TextFormField(\n                initialValue: _ipAddress,\n                decoration: const InputDecoration(\n                  labelText: \'Controller IP Address\',\n                  border: OutlineInputBorder(),\n                ),\n                validator: (value) {\n                  if (value == null || value.isEmpty) {\n                    return \'Please enter the IP address\';\n                  }\n                  return null;\n                },\n                onSaved: (value) => _ipAddress = value!,\n              ),\n              const SizedBox(height: 16),\n              TextFormField(\n                decoration: const InputDecoration(\n                  labelText: \'Username\',\n                  border: OutlineInputBorder(),\n                ),\n                validator: (value) {\n                  if (value == null || value.isEmpty) {\n                    return \'Please enter the username\';\n                  }\n                  return null;\n                },\n                onSaved: (value) => _username = value!,\n              ),\n              const SizedBox(height: 16),\n              TextFormField(\n                decoration: const InputDecoration(\n                  labelText: \'Password\',\n                  border: OutlineInputBorder(),\n                ),\n                obscureText: true,\n                validator: (value) {\n                  if (value == null || value.isEmpty) {\n                    return \'Please enter the password\';\n                  }\n                  return null;\n                },\n                onSaved: (value) => _password = value!,\n              ),\n              const SizedBox(height: 24),\n              _isLoading\n                  ? const CircularProgressIndicator()\n                  : ElevatedButton(\n                      onPressed: _login,\n                      style: ElevatedButton.styleFrom(\n                        padding: const EdgeInsets.symmetric(horizontal: 40, vertical: 15),\n                        textStyle: const TextStyle(fontSize: 16),\n                      ),\n                      child: const Text(\'Login\'),\n                    ),\n              const SizedBox(height: 20),\n              if (_status.isNotEmpty)\n                Text(\n                  _status,\n                  style: TextStyle(\n                    color: _token != null ? Colors.green : Colors.red,\n                  ),\n                ),\n            ],\n          ),\n        ),\n      ),\n    );\n  }\n}\n